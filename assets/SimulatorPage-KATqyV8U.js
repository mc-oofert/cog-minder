import{t as eo,j as n,u as oo,r as _,c as Ne,S as Ae,b as d,z as G,d as U,B as Z,a as ao,f as h,D as no,e as to,p as so,g as io}from"./index-OAMPF_1i.js";import{L as ze,a as lo,s as ro,b as co,m as ke,c as Be,d as De,v as uo,g as mo,e as ho,f as po,i as fo,h as vo,j as Re}from"./simulatorCalcs-a7tnXXEh.js";import{u as Le,I as bo,C as yo}from"./ItemPopover-WS-vGn1n.js";import{S as go,e as xo,C as Co,n as To,p as wo,o as jo,L as Mo,q as No,c as Ao,b as ko,f as Q,g as Bo,h as Do,i as Ro}from"./chartColors-dgqLuKe-.js";import{u as Ve}from"./BotDetails-WmK0wCeg.js";import{B as Fo}from"./BotPopover-xvE5Z1EB.js";/* empty css              */import"./botTypes-Cxei0LoN.js";import"./items-bCTdCTgI.js";import"./bots-EPaA02tF.js";import"./lore-yoaB2RHm.js";Co.register(To,wo,jo,Mo,No,Ao,ko);function Fe({chartTitle:o,values:t,backgroundColors:e,borderColors:r,isPercentage:c,stepSize:g,xLabel:f,yLabel:k}){const x=eo(),i=Math.max(...t.map(u=>Math.max(...u.values.map(L=>L.x))));return n.jsx(go,{data:Eo(t,e,r),datasetIdKey:"id",options:zo(o,c,g,x,f,k,i),plugins:[xo]})}function Eo(o,t,e){return{datasets:o.map((r,c)=>({backgroundColor:t[c],borderColor:e[c],data:r.values,fill:"start",id:r.id||r.label,label:r.label,pointRadius:0,pointHitRadius:25,showLine:!0,stepped:"before"}))}}function zo(o,t,e,r,c,g,f){return{animation:{duration:300},color:Q,maintainAspectRatio:!1,plugins:{chartCanvasBackgroundColor:{color:r==="Cogmind"?Bo:Do},legend:{labels:{font:{size:16}}},title:{color:Q,font:{size:24},display:!0,text:o}},scales:{x:{border:{display:!1},min:0,max:f,grid:{display:!1},ticks:{color:Q,stepSize:e},title:{color:Q,display:c!==void 0,font:{size:24},text:c}},y:{border:{display:!1},max:t?100:void 0,min:t?0:void 0,grid:{color:Ro},ticks:{callback:t?(k,x,i)=>k+"%":void 0,color:Q},title:{color:Q,display:g!==void 0,font:{size:24},text:g}}}}}const me=[{value:"Stand/Fight"},{value:"Siege/Fight"},{value:"Already Sieged/Fight"},{value:"Running"},{value:"Run When Hit"}],Lo=[{value:"Ranged"},{value:"Melee"}],he=[{value:"None",label:"No damage reduction"},{value:"Remote Shield",label:"Remote Shield (25%)"},{value:"Stasis Trap",label:"Stasis Trap (25%)"},{value:"Phase Wall",label:"Phase Wall (50%)"},{value:"Remote Force Field",label:"Remote Force Field (50%)"},{value:"Stasis Bubble",label:"Stasis Bubble (50%)"}],be=[{value:"Kill"},{value:"Kill or Core Disrupt"},{value:"Kill or No Power"},{value:"Kill or No Weapons"}],We=[...be];We.push({value:"Tele",label:"Architect Tele (80% integrity, 1 weapon, or 1 prop)"});const Ie=[...be];Ie.push({value:"Kill or No TNC"});const pe=[{value:"No Siege"},{value:"In Siege Mode"},{value:"In High Siege Mode"},{value:"Entering Siege Mode"},{value:"Entering High Siege Mode"}],fe=[{value:"None"},{value:"First Only"},{value:"All"}],Vo=[{value:"Volleys"},{value:"Time"}],ee=[{value:"No"},{value:"Yes"}],Wo=["Impact Weapon","Piercing Weapon","Slashing Weapon","Special Melee Weapon"],Io=["Ballistic Cannon","Ballistic Gun","Energy Cannon","Energy Gun","Launcher","Special Weapon"],Ko=["Core Cannon","Core Stripper","Modified Sigix Sheargun","Sigix Broadsword","Sigix Shearcannon","Sigix Sheargun"];function qo({disabled:o,i:t,pageState:e,updatePageState:r,weaponInfo:c,weaponItem:g,weaponOptions:f}){let k;const x=e.weaponState[t];return g.overloadStability?k=n.jsx(U,{label:"Overload",disabled:o,buttons:ee,tooltip:"Whether to fire the weapon as overloaded (double damage). Does not take into account effects of additional heat generation or stability-related effects.",selected:x.overload||"No",onValueChanged:i=>{const u=[...e.weaponState];u[t]={...x,overload:i},r({...e,weaponState:u})}}):Ko.includes(g.name)&&(k=n.jsx(U,{label:"Exoskeleton",disabled:o,buttons:ee,tooltip:"Whether a Sigix Exoskeleton is equipped (double damage on non-AOE Sigix weaponry).",selected:x.exo||"No",onValueChanged:i=>{const u=[...e.weaponState];u[t]={...x,exo:i},r({...e,weaponState:u})}})),n.jsxs("div",{className:"weapon-row",children:[n.jsxs("div",{className:"flex",children:[n.jsx(G,{id:c.id.toString(),isDisabled:o,className:"weapon-select",label:"Weapon",tooltip:"Name of an equipped weapon to fire.",options:f,value:f.find(i=>i.value===c.name),onChange:i=>{const u=[...e.weaponState];u[t]={id:x.id,name:i.value,number:x.number},r({...e,weaponState:u})}}),n.jsx(bo,{item:g,tooltip:"Show details about the part.",text:"?"})]}),n.jsx(d,{label:"Number",disabled:o,className:"flex-1-1",value:c.number||"",onChange:i=>{const u=[...e.weaponState];u[t]={...x,number:i},r({...e,weaponState:u})},placeholder:"1",tooltip:"How many weapons of this type to have equipped."}),k,n.jsx(Z,{tooltip:"Deletes this weapon.",disabled:o,onClick:()=>{const i=[...e.weaponState];i.splice(i.indexOf(c),1),r({...e,weaponState:i})},children:"X"})]})}function Oo({pageState:o,simulationInProgress:t,updatePageState:e}){var V;const r=Ve(),c=Le(),g=oo(),f=_.useMemo(()=>r.getAllBotsSorted().filter(a=>Ne(a.spoiler,g)).map(a=>({value:a.name})),[g]),k=_.useMemo(()=>c.getAllItemsSorted().filter(a=>{if(!Ne(a.spoiler,g))return!1;if(o.combatType==="Melee"){if(!Wo.includes(a.type))return!1}else if(!Io.includes(a.type))return!1;if(a.damageType!=="Special")return!0}).map(a=>({value:a.name})),[g,o]),x=r.getBotOrNull(o.botName||"")===null?"G-34 Mercenary":o.botName,i=r.getBot(x);let u;i.name==="Architect"?u=We:i.name==="A-15 Conveyor"?u=Ie:u=be;const L=n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"page-input-group",children:[n.jsx(Ae,{label:"Melee Analysis Suites",tooltip:"The number of each type of Melee Analysis Suites equipped. Provides bonus accuracy and a minimum damage increase, but not more than the maximum damage for a weapon."}),n.jsx(d,{label:"Standard",disabled:t,value:o.baseMas||"",onChange:a=>e({...o,baseMas:a}),placeholder:"0",tooltip:"The amount of standard Melee Analysis Suites equipped. Each provides 5% accuracy and a minimum damage increase of 2."}),n.jsx(d,{label:"Imp.",disabled:t,value:o.impMas||"",onChange:a=>e({...o,impMas:a}),placeholder:"0",tooltip:"The amount of Improved Melee Analysis Suites equipped. Each provides 6% accuracy and a minimum damage increase of 3."}),n.jsx(d,{label:"Adv.",disabled:t,value:o.advMas||"",onChange:a=>e({...o,advMas:a}),placeholder:"0",tooltip:"The amount of Advanced Melee Analysis Suites equipped. Each provides 8% accuracy and a minimum damage increase of 4."}),n.jsx(d,{label:"Exp.",disabled:t,value:o.expMas||"",onChange:a=>e({...o,expMas:a}),placeholder:"0",tooltip:"The amount of Experimental Melee Analysis Suites equipped. Each provides 12% accuracy and a minimum damage increase of 6."})]}),n.jsxs("div",{className:"page-input-group",children:[n.jsx(Ae,{label:"Force Boosters",tooltip:"The number of each type of Force Booster equipped. Provides a bonus to maximum damage and a decrease to accuracy. These utilities half_stack, so only the 2 highest ratings count."}),n.jsx(d,{label:"Standard",disabled:t,value:o.baseForceBoosters||"",onChange:a=>e({...o,baseForceBoosters:a}),placeholder:"0",tooltip:"The amount of standard Force Boosters equipped. Provides a maximum damage increase of 20% and a melee accuracy penalty of 4%."}),n.jsx(d,{label:"Imp.",disabled:t,value:o.impForceBoosters||"",onChange:a=>e({...o,impForceBoosters:a}),placeholder:"0",tooltip:"The amount of Improved Force Boosters equipped. Provides a maximum damage increase of 30% and a melee accuracy penalty of 6%."}),n.jsx(d,{label:"Adv.",disabled:t,value:o.advForceBoosters||"",onChange:a=>e({...o,advForceBoosters:a}),placeholder:"0",tooltip:"The amount of Advanced Force Boosters equipped. Provides a maximum damage increase of 40% and a melee accuracy penalty of 8%."})]}),n.jsxs("div",{className:"page-input-group",children:[n.jsx(d,{label:"Initial Momentum",disabled:t,value:o.initialMomentum||"",onChange:a=>e({...o,initialMomentum:a}),placeholder:"0",tooltip:"The momentum bonus from movement for the first attack. This should be 0-3."}),n.jsx(d,{label:"Bonus Momentum",disabled:t,value:o.bonusMomentum||"",onChange:a=>e({...o,bonusMomentum:a}),placeholder:"0",tooltip:"The amount of bonus momentum from Reaction Control Systems (Always 0 or 1, no_stack)."}),n.jsx(d,{label:"Speed",disabled:t,value:o.speed||"",onChange:a=>e({...o,speed:a}),placeholder:"100",tooltip:"The speed of Cogmind. Higher speed provides increased momentum bonus damage."}),n.jsx(G,{className:"sneak-attack-select",isDisabled:t,label:"Sneak Attacks",isSearchable:!1,tooltip:"Whether to perform sneak attacks or not. Sneak attacks provide a base hit chance of 120% and double damage.",options:fe,value:fe.find(a=>a.value===o.sneakAttacks)||fe[0],onChange:a=>{e({...o,sneakAttacks:a.value})}})]})]}),H=n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"page-input-group",children:[n.jsx(d,{label:"Targeting",disabled:t,value:o.targeting||"",onChange:a=>e({...o,targeting:a}),placeholder:"0%",tooltip:"The amount of targeting bonus from Targeting Computers or similar utilities (stacks). Base is 5%, Improved is 6%, Advanced is 8%, Experimental is 12%."}),n.jsx(d,{label:"Recoil Reduction",disabled:t,value:o.recoilReduction||"",onChange:a=>e({...o,recoilReduction:a}),placeholder:"0",tooltip:"The number of recoil reduction. Each tread slot has 1 recoil reduction, Recoil Stabilizers have 4, and Recoil Nullifiers have 6."}),n.jsx(d,{label:"Distance",disabled:t,value:o.distance||"",onChange:a=>e({...o,distance:a}),placeholder:"6+",tooltip:"The distance from the target. Each tile closer than 6 tiles away provides 3% accuracy up to 15% at 1 tile away."}),n.jsx(G,{className:"siege-select",isDisabled:t,label:"Siege",isSearchable:!1,tooltip:"The type of siege mode active (if any). Siege mode removes all recoil and adds a 20% (standard) or 30% (high) bonus to targeting.",options:pe,value:pe.find(a=>a.value===o.siege)||pe[0],onChange:a=>{e({...o,siege:a.value})}})]}),n.jsxs("div",{className:"page-input-group",children:[n.jsx(d,{label:"Particle Charging",disabled:t,value:o.particleCharger||"",onChange:a=>e({...o,particleCharger:a}),placeholder:"0%",tooltip:"The bonus from Particle Charger/Accelerators that are equipped (if any). Increases damage of energy gun/cannon weapons (half_stack). Base charger starts at 15%, going to 20%, 25%, 30%, 40%, and 50%."}),n.jsx(d,{label:"Kinecellerator",value:o.kinecellerator||"",disabled:t,onChange:a=>e({...o,kinecellerator:a}),placeholder:"0%",tooltip:"The bonus from a Kinecellerator that's equipped (if any). INcreases minimum damage of kinetic gun/cannon weapons. Base Kinecellerator starts at 30%, Improved at 40%, and Advanced at 50%."}),n.jsx(d,{label:"Weapon Cycling",disabled:t,value:o.weaponCycling||"",onChange:a=>e({...o,weaponCycling:a}),placeholder:"0%",tooltip:"The percentage of Weapon Cycling or similar utilities that are equipped (if any). Decreases overall volley time. Stacks up to 30%, though a Quantum Capacitor or Launcher Loader can go up to 50%."}),n.jsx(d,{label:"Salvage Targeting",disabled:t,value:o.salvageTargeting||"",onChange:a=>e({...o,salvageTargeting:a}),placeholder:"0%",tooltip:"The bonus of Salvage Targeting Computers that are equipped (if any). Increase salvage generated from Gun-type weapons that fire a single projectile (stacks). Base Salvage Targeting Computer starts at +1, Improved is +2, Advanced is +3, and Makeshift is +4."})]})]}),w=n.jsxs(n.Fragment,{children:[(V=o.weaponState)==null?void 0:V.map((a,B)=>{const R=c.getItem(a.name);return n.jsx(qo,{disabled:t,pageState:o,updatePageState:e,weaponItem:R,weaponInfo:a,weaponOptions:k,i:B},a.id)}),n.jsx("div",{className:"new-weapon-row",children:n.jsx(G,{label:"Weapon",isDisabled:t,className:"weapon-select",tooltip:"Name of an equipped weapon to fire.",options:k,controlShouldRenderValue:!1,onChange:a=>{const B=[...o.weaponState||[]],R=Math.max(0,...B.map(I=>I.id+1));B.push({name:a.value,id:R}),e({...o,weaponState:B})}})})]});return n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"page-input-group",children:[n.jsx(U,{label:"Combat Type",disabled:t,buttons:Lo,className:"flex-grow-0",tooltip:"The type of weapons to display. Melee and ranged weapons also have unique utilities and other settings.",selected:o.combatType,onValueChanged:a=>{e({...o,weaponState:[],combatType:a})}}),n.jsx(d,{label:"Num Fights",disabled:t,value:o.numSimulations||"",onChange:a=>e({...o,numSimulations:a}),placeholder:"100,000",tooltip:"The number of fights to simulate. High numbers will increase result accuracy but also increase time to calculate."}),n.jsx(G,{className:"enemy-behavior-select",isDisabled:t,label:"Enemy Behavior",tooltip:"The behavior of the enemy when engaged in combat. THe default for most hostile combat bots is Stand/Fight, and the behavior of most non-combat bots will be RUn When Hit.",isSearchable:!1,options:me,value:me.find(a=>a.value===o.enemyBehavior)||me[0],onChange:a=>{e({...o,enemyBehavior:a.value})}}),n.jsx(Z,{tooltip:"Resets all values to their default state",disabled:t,className:"flex-grow-0",onClick:()=>e({}),children:"Reset"})]}),n.jsxs("div",{className:"page-input-group",children:[n.jsxs("div",{className:"enemy-group",children:[n.jsx(G,{label:"Enemy",className:"enemy-select",isDisabled:t,tooltip:"The name of the enemy bot to fight.",options:f,value:f.find(a=>a.value===x),onChange:a=>{e({...o,botName:a.value})}}),n.jsx(Fo,{bot:i,text:"?",tooltip:"Show details about the bot."})]}),n.jsx(U,{label:"Analysis",buttons:ee,disabled:t,tooltip:"Does Cogmind have the analysis for this bot? An analysis provides bonuses of 5% accuracy and 10% damage.",selected:o.analysis||"No",onValueChanged:a=>{e({...o,analysis:a})}}),n.jsx(G,{label:"Damage Reduction",isDisabled:t,className:"damage-reduction-select",tooltip:"The type of external damage reduction (if any) for the enemy. Note: this does not stack with personal damage reduction utilities.",isSearchable:!1,options:he,value:he.find(a=>a.value===o.damageReduction)||he[0],onChange:a=>{e({...o,damageReduction:a.value})}})]}),n.jsxs("div",{className:"page-input-group",children:[n.jsx(d,{label:"Actions Since Moving",disabled:t,value:o.actionsSinceMoving||"",onChange:a=>e({...o,actionsSinceMoving:a}),placeholder:"2+",tooltip:"The number of actions performed since Cogmind last moved. For melee, there is a +10% accuracy bonus gained after not moving for 2 turns. For ranged, there is an additional -10% penalty if the most recent action was a move. Basically, 0 turns since moving = -10%, 1 turn = 0%, 2 turns = 10%."}),n.jsx(U,{label:"On Legs",disabled:t,buttons:ee,tooltip:"Is Cogmind on legs? If so, the number of tiles run in a row provide an additional 5% penalty per tile moved.",selected:o.onLegs||"No",onValueChanged:a=>{e({...o,onLegs:a})}}),n.jsx(d,{label:"Tiles Run",disabled:t,value:o.tilesRun||"",onChange:a=>e({...o,tilesRun:a}),placeholder:"0",tooltip:"The number of tiles Cogmind has been running for if on legs. There is a -5% penalty per tile moved for ranged weapons, up to a maximum of -15%."})]}),o.combatType==="Melee"?L:H,n.jsxs("div",{className:"page-input-group last-pre-weapon-row",children:[n.jsx(d,{label:"Armor Integrity Analyzer",disabled:t,value:o.armorIntegrityAnalyzer||"",onChange:a=>e({...o,armorIntegrityAnalyzer:a}),placeholder:"0%",tooltip:"The type of armor integrity analyzer that's equipped (if any). Adds a chance of bypassing enemy armor. Values are 30% for basic, 40% for Improved, and 50% for Experimental."}),n.jsx(d,{label:"Core Analyzer",disabled:t,value:o.coreAnalyzer||"",onChange:a=>e({...o,coreAnalyzer:a}),placeholder:"0%",tooltip:"The bonus from one or more Core Analyzers that are equipped (if any). Increases core exposure by the specific amount (half_stack). Base Analyzer is 6% and Experimental is 8%, for a maximum of 12%."}),n.jsx(d,{label:"Target Analyzer",disabled:t,value:o.targetAnalyzer||"",onChange:a=>e({...o,targetAnalyzer:a}),placeholder:"0%",tooltip:"The bonus from one or more Target Analyzers that are equipped (if any). Increases critical hit % chance for weapons with a critical hit (half_stack). Base Analyzer is 5%, Improved is 6%, Advanced is 8%, and Experimental is 10%."}),o.combatType==="Melee"&&n.jsxs(n.Fragment,{children:[n.jsx(d,{label:"Actuator",disabled:t,value:o.actuator||"",onChange:a=>e({...o,actuator:a}),placeholder:"0%",tooltip:"The bonus from actuator that's equipped (if any). Decreases volley time by a fixed percentage. Microactuators are 20%, Nanoacturators are 30%, and Femtoactuators are 50%."}),n.jsx(d,{label:"Actuator Array",disabled:t,value:o.actuatorArray||"",onChange:a=>e({...o,actuatorArray:a}),placeholder:"0%",tooltip:"The bonus from one or two actuator arrays equipped. Increases followup chance for all weapons (half_stack). Base Actuator Array is 10%, Improved is 12%, Advanced is 16%, and Experimental is 20%."})]})]}),w,n.jsxs("div",{className:"page-input-group",children:[n.jsx(U,{label:"X-Axis",disabled:t,className:"flex-grow-0",buttons:Vo,tooltip:"The type of x-axis to show on the graph.",selected:o.xAxis||"Volleys",onValueChanged:a=>{e({...o,xAxis:a})}}),n.jsx(U,{label:"Show Loot",disabled:t,className:"flex-grow-0",buttons:ee,tooltip:"Whether or not to show estimated loot drops. Expected matter and part drop rate chance and integrity are shown. Crit off rate shows the % of the drop rate that was caused due to blast, sever, or sunder critical hits, if applicable.",selected:o.showLoot||"No",onValueChanged:a=>{e({...o,showLoot:a})}}),n.jsx(G,{label:"End Condition",isDisabled:t,tooltip:"The scenario to occur before the simulation is ended.",isSearchable:!1,options:u,value:u.find(a=>a.value===o.endCondition)||u[0],onChange:a=>{e({...o,endCondition:a.value})}})]})]})}const Ee=["rgba(228, 26, 28, .8)","rgba(55, 126, 184, .8)","rgba(36, 192, 36, .8)","rgba(152, 78, 163, .8)","rgba(255, 127, 0, .8)","rgba(255, 255, 51, .8)","rgba(243, 145, 146, .8)","rgba(145, 187, 222, .8)","rgba(135, 232, 135, .8)","rgba(202, 159, 209, .8)","rgba(255, 194, 133, .8)","rgba(163, 163, 0, .8)"];let ve=!1;function Go(){const o=to(),t=so(o,{});let e;if(t.weaponState!==void 0){const r=ze.decompressFromEncodedURIComponent(t.weaponState);if(r!==null){const c=JSON.parse(r);Array.isArray(c)&&(e=c)}}return{...t,weaponState:e}}const _o=/Core Regeneration \((\d*)\)/;function Ho(o){const t=o.traits;for(let e=0;e<t.length;e++){const r=_o.exec(t[e]);if(r!=null)return parseInt(r[1])}return 0}function Uo(o){let t;if(o.weaponState&&o.weaponState.length>0){const e=JSON.stringify(o.weaponState);t=ze.compressToEncodedURIComponent(e)}return{...o,weaponState:t}}function $o(o,t,e,r){const c=e.botName||"G-34 Mercenary",g=[];for(const l of e.weaponState??[]){const p=t.tryGetItem(l.name);if(p===void 0||p.slot!=="Weapon"){r(`Item ${l.name} is not a valid weapon, this is probably a bug.`);return}const s=h(l.number,1),T=l.overload==="Yes",A=l.exo==="Yes";for(let O=0;O<s;O++)g.push({def:p,overloaded:T||A})}if(g.length===0){r("There must be at least 1 weapon selected.");return}const f=[];let k=0;function x(l,p){const s=l.type==="Protection",T=l.type==="Treads",A=l.coverage??0,O=s||T?2*A:A;f.push({armorAnalyzedCoverage:s?0:A,armorAnalyzedSiegedCoverage:s?0:O,coverage:A,def:l,integrity:p,initialIndex:k++,protection:s,selfDamageReduction:1,siegedCoverage:O})}const i=o.getBotOrNull(c);if(!i){r(`Bot ${c} is invalid, this is probably a bug.`);return}i.componentData.concat(i.armamentData).concat(i.componentOptionData.map(l=>l[0])).concat(i.armamentOptionData.map(l=>l[0])).forEach(l=>{for(let p=0;p<l.number;p++){const s=t.getItem(l.name);x(s,s.integrity)}});const u=i.coreCoverage,L=i.totalCoverage,H=i.coreIntegrity,w=u+f.reduce((l,p)=>l+p.armorAnalyzedCoverage,0),V=u+f.reduce((l,p)=>l+p.siegedCoverage,0),a=u+f.reduce((l,p)=>l+p.siegedCoverage,0),B=e.enemyBehavior||"Stand/Fight",R=lo(f,e.damageReduction||"None");let I=0;i.speed<100?I=Math.trunc((100-i.speed)/5):I=0;const oe=B==="Already Sieged/Fight"&&f.find(l=>l.def.type==="Treads"&&l.def.siege!==void 0)!==void 0,$={armorAnalyzedCoverage:w,armorAnalyzedSiegedCoverage:V,behavior:B,coreCoverage:u,coreDisrupted:!1,coreIntegrity:H,corruption:0,def:i,defensiveState:R,externalDamageReduction:e.damageReduction||"None",immunities:i.immunities,initialCoreIntegrity:H,parts:f,regen:Ho(i),resistances:i.resistances===void 0?{}:i.resistances,running:B==="Running",runningEvasion:I,runningMomentum:B==="Running"?3:0,salvage:0,sieged:oe,siegedCoverage:a,totalCoverage:L,tusToSiege:B==="Siege/Fight"?500:0};let ae=!1;const M=e.combatType==="Melee",ne={bonus:0,tus:0},le=M?ne:ro.get(e.siege)||ne;let S=0;M||(S=h(e.targeting,0));const m=[h(e.baseMas,0),h(e.impMas,0),h(e.advMas,0),h(e.expMas,0)],v=[h(e.baseForceBoosters,0),h(e.impForceBoosters,0),h(e.advForceBoosters,0)];if(M){let l=2;for(let p=v.length-1;p>=0;p--)v[p]>l?(v[p]=l,l=0):l-=v[p]}let C=h(e.distance,6);C<=1&&(C=1);const b=h(e.recoilReduction,0),j=g.reduce((l,p)=>co(p.def,b)+l,0),N=h(e.targetAnalyzer,0),y=h(e.salvageTargeting,0),D=g.map((l,p)=>{const s=l.def;let T=0,A=0,O,ie=0,re=0,je;if(s.damage!==void 0){if(s.damage.includes("-")){const z=s.damage.split("-");T=parseInt(z[0]),A=parseInt(z[1])}else T=parseInt(s.damage),A=T;if(s.type==="Ballistic Gun"||s.type==="Ballistic Cannon"){const z=h(e.kinecellerator,0);T=Math.trunc(T*(1+z/100)),T>A&&(A=T)}else if(M){let z=0;for(let E=0;E<ke.length;E++)z+=m[E]*ke[E];T=Math.min(z+T,A);let de=0,ue=0;for(let E=v.length-1;E>=0;E--)v[E]==2?(de=1.5*Re[E],ue+=2):v[E]==1&&(de+=Re[E]*(ue==0?1:.5),ue+=1);A=Math.floor(A*(1+de))}O=s.damageType}if(s.explosionDamage!==void 0){if(s.explosionDamage.includes("-")){const z=s.explosionDamage.split("-");ie=parseInt(z[0]),re=parseInt(z[1])}else ie=parseInt(s.explosionDamage),re=ie;je=s.explosionType}let ce;s.criticalType===yo.Meltdown?ce=s.critical:ce=s.critical===void 0||s.critical===0?0:s.critical+N;let J=M?fo:vo;M||(J+=S),Be.has(i.size)?J+=Be.get(i.size):console.log(`${c} has invalid size ${i.size}`),s.targeting!==void 0&&(J+=s.targeting);const $e=h(s.delay,0);M&&p!=0&&(J+=10);const Se=s.disruption??0,Ye=s.explosionDisruption??0,Xe=De(s.spectrum),Je=De(s.explosionSpectrum),Qe=s.minChunks??1,Ze=s.maxChunks??1;s.name==="Ram"&&(ae=!0);const Pe=s.type==="Launcher"&&s.name!="Sigix Terminator"&&s.name!="Supercharged Sigix Terminator"&&s.name!="Vortex Catalyst Activator";let Me=s.salvage??0;return y>0&&s.projectileCount==1&&(s.type==="Ballistic Gun"||s.type==="Energy Gun")&&(Me+=y),{accelerated:s.type==="Energy Gun"||s.type==="Energy Cannon",accuracy:J,baseAccuracy:J,criticalChance:ce,criticalType:s.criticalType,damageMin:T,damageMax:A,damageType:O,def:s,delay:$e,disruption:Se,explosionChunksMin:Qe,explosionChunksMax:Ze,explosionDisruption:Ye,explosionMin:ie,explosionMax:re,explosionSpectrum:Je,explosionType:je,isMissile:Pe,numProjectiles:s.projectileCount,overflow:!s.type.includes("Gun"),overloaded:l.overloaded,salvage:Me,spectrum:Xe}}),F=1+Math.max(h(e.particleCharger,0),0)/100,W=h(e.armorIntegrityAnalyzer,0),K=h(e.coreAnalyzer,0),Y=h(e.actuatorArray,0),q=[];if(M){const l=20+Y;D.forEach((p,s)=>{if(s!=0){let T=l+Math.trunc((D[0].delay-p.delay)/10);T=Math.min(T,100),T=Math.max(T,0),q.push(T)}})}const X=h(e.speed,100),ye=h(e.bonusMomentum,0),ge=h(e.initialMomentum,0),Ke=e.sneakAttacks||"None",qe=Math.max(0,Math.min(99,h(e.actuator,0))),Oe=Math.max(0,Math.min(99,h(e.weaponCycling,0))),xe=1-(M?qe:Oe)/100,Ge=M?D[0].delay+uo[1]:mo(D.map(l=>l.def),xe);let P,se;const Ce=h(e.actionsSinceMoving,2);Ce==0?(P=M?0:-10,se=0):Ce==1?(P=0,se=10):(P=10,se=10);const Te=e.onLegs==="Yes"?h(e.tilesRun,0):0;Te>0&&!M&&(P-=Math.min(Te,3)*5);const we=[];for(const l of $.parts)we.push({item:l.def,numDrops:0,totalCritRemoves:0,totalCorruptionPercent:0,totalFried:0,totalIntegrity:0});const _e={numKills:0,items:we,matterBlasted:0,matterDrop:0},He={action1Accuracy:P,action2Accuracy:se,armorAnalyzerChance:W,analysis:e.analysis==="Yes",chargerBonus:F,coreAnalyzerChance:K,distance:C,followupChances:q,forceBoosters:v,melee:M,meleeAnalysis:m,momentum:{bonus:ye,current:ye+ge,initial:ge},ramming:ae,recoil:j,recoilReduction:b,siegeBonus:le,sneakAttack:!1,sneakAttackStrategy:Ke,speed:X,targetingComputerBonus:S,volleyTime:Ge,volleyTimeModifier:xe},Ue=e.endCondition||"Kill";return{actionNum:0,botState:$,endCondition:Ue,initialBotState:$,killTus:{},killVolleys:{},lootState:_e,offensiveState:He,tus:0,weapons:D}}function So(o,t){const e=o;return e==="analysis"&&t.analysis==="No"||e==="combatType"&&t.combatType==="Ranged"||e==="damageReduction"&&t.damageReduction==="None"||e==="endCondition"&&t.endCondition==="Kill"||e==="enemyBehavior"&&t.enemyBehavior==="Stand/Fight"||e==="onLegs"&&t.onLegs==="No"||e==="siege"&&t.siege==="No Siege"||e==="xAxis"&&t.xAxis==="Volleys"}function ca(){var S;const[o,t]=ao(),e=Ve(),r=Le(),c=Go(),[g,f]=_.useState(!1),[k,x]=_.useState(""),[i,u]=_.useState(void 0),[L,H]=_.useState(""),[w,V]=_.useState({comparisonChartName:"",datasets:[]}),a=_.useRef(null);function B(m){const v=Uo(m),C=io("/simulator",v,So);t(C,{replace:!0})}const R=h((S=c.numSimulations)==null?void 0:S.replace(",",""),1e5);let I,oe,$;if(i!==void 0){let m,v,C,b;c.xAxis==="Time"?(m=`Time Units/Kill vs ${i.botName}`,C=i.cumulativeKillPerTuData,v=i.killPerTuData,b="Number of Time Units"):(m=`Volleys/Kill vs ${i.botName}`,C=i.cumulativeKillPerVolleyData,v=i.killPerVolleyData,b="Number of Volleys"),I=n.jsx("div",{className:"chart-container",children:n.jsx(Fe,{backgroundColors:["rgba(0, 98, 0, 0.3)","rgba(96, 96, 96, .3)"],borderColors:["rgba(0, 196, 0, 1)","rgba(128, 128, 128, 1)"],chartTitle:m,isPercentage:!0,values:[{label:"Current volley kill %",values:v},{label:"Cumulative Kill %",values:C}],xLabel:b,yLabel:"Percent of Kills"})}),oe=n.jsxs("div",{className:"page-input-group",children:[n.jsx(d,{label:"Dataset Name",value:L||"",onChange:j=>H(j),placeholder:"Enter dataset name",tooltip:"The name for this dataset when added to the custom comparison chart. Can be renamed once added."}),n.jsx(Z,{className:"flex-grow-0",onClick:()=>{const j={...w},N=new Array(Ee.length).fill(0);for(const F of w.datasets)N[F.colorIndex]+=1;let y=0,D;for(;D=N.indexOf(y),!(D>=0);)y+=1;const te=w.datasets.length===0?0:Math.max(...w.datasets.map(F=>F.id))+1;j.datasets=[...w.datasets,{colorIndex:D,data:i.comparisonData,id:te,name:L}],V(j),H("")},disabled:L==="",children:"Add To Comparison"})]})}if(w.datasets.length>0){const m=[],v=[],C=[];for(const b of w.datasets)m.push("rgba(0, 0, 0, 0)"),v.push(Ee[b.colorIndex]),C.push({id:b.id.toString(),label:b.name,values:b.data});$=n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"page-input-group",children:n.jsx(d,{label:"Chart Name",value:w.comparisonChartName||"",onChange:b=>V({...w,comparisonChartName:b}),placeholder:"Custom Comparison",tooltip:"The name for this dataset when added to the custom comparison chart. Can be renamed once added."})}),n.jsx("div",{className:"custom-dataset-groups",children:w.datasets.map((b,j)=>n.jsxs("div",{children:[n.jsx(no,{onChange:N=>{const y=[...w.datasets];y[j]={...y[j],name:N},V({...w,datasets:y})},value:b.name}),n.jsx(Z,{onClick:()=>{const N=[...w.datasets];N.splice(j,1),V({...w,datasets:N})},children:"X"})]},b.id))}),n.jsx("div",{className:"chart-container",children:n.jsx(Fe,{backgroundColors:m,borderColors:v,chartTitle:w.comparisonChartName||"Custom Comparison",isPercentage:!0,values:C,xLabel:"Number of Time Units",yLabel:"Percent of Kills"})})]})}function ae(){let m=0;const v=performance.now();let C=v,b=C;const j=$o(e,r,c,x);if(j===void 0){f(!1);return}function N(){for(;m<R;m++){if(ve)return;if(m%100===0){const y=performance.now();if(y-C>30){if(C=y,y-b>100){const D=(m*100/R).toFixed(1);a.current.innerHTML=`${String(D).padStart(4,"0")} % completed.`,b=y}setTimeout(N,0);break}}try{if(!ho(j)){x(`The simulation exceeded ${po} volleys and will likely never kill.`),f(!1);return}}catch(y){console.log(y),x("The simulation encountered an unexpected error, this is a bug."),f(!1);return}}if(m>=R){let y=performance.now()-v;y/=1e3,x(`Completed in ${y.toFixed(2)} seconds.`),f(!1),ne(j)}}ve=!1,f(!0),N()}function M(){ve=!0,f(!1),x("Simulation cancelled"),a.current.innerHTML="Simulation cancelled"}function ne(m){function v(F,W,K,Y){const q=F.filter(X=>W[X]/R>Math.pow(10,-2-K)).map(X=>({x:parseInt(X),y:Math.trunc(W[X]/R*Math.pow(10,2+K))/Math.pow(10,K)}));return q.length<5&&q.push({x:q[q.length-1].x+Y,y:0}),q}function C(F){const W=[];let K=0;return F.forEach(Y=>{K+=Y.y,W.push({x:Y.x,y:Math.trunc(K*100)/100})}),W}const b=Object.keys(m.killTus);b.sort((F,W)=>parseFloat(F)-parseFloat(W));const j=C(v(b,m.killTus,m.offensiveState.melee?3:1,100)),N=v(Object.keys(m.killVolleys),m.killVolleys,1,1),y=v(b,m.killTus,m.offensiveState.melee?3:1,m.offensiveState.volleyTime),D=C(N),te=C(y);u({botName:c.botName||"G-34 Mercenary",comparisonData:j,cumulativeKillPerTuData:te,cumulativeKillPerVolleyData:D,killPerTuData:y,killPerVolleyData:N,volleyTime:m.offensiveState.volleyTime})}const le=g?n.jsx(Z,{className:"simulate-button",tooltip:"Cancels the running simulation",onClick:M,children:"Cancel"}):n.jsx(Z,{className:"simulate-button",tooltip:"Run the simulation",onClick:ae,children:"Simulate"});return n.jsxs("div",{className:"page-content",children:[n.jsx(Oo,{pageState:c,simulationInProgress:g,updatePageState:B}),n.jsxs("div",{className:"simulate-row",children:[le,n.jsx("label",{ref:a,className:"status-text",children:k})]}),I,oe,$]})}export{ca as default,Ho as getRegen};
